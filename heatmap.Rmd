---
title: "heatmap"
author: "Cheryl"
date: "4/13/2018"
output: html_document
---
R code for Heatmaps (Copper Rockfish Gill)

First, download the following packages:

```{r}
library(tidyverse) # after install.packages('tidyverse')
library(reshape2)  # after install.packages('reshape2')
library(ggplot2)   # after install.packages('ggplot2')
```

Install necessary packages and load libraries. You only need to install the packages once, but need to load the libraries every time you open up a new R session.

Display working directory (equivalent of pwd in terminal)

```{r}
getwd()
```

If necessary, change the working directory to location of your expression data file

```{r}
setwd("/Users/github/bio430")
```

Load data
```{r}
data <- read_csv("diffExpr.P0.01_C1.matrix.log2.centered.csv")
```

# need to reshape data into 2 columns before heatmap

ContigName   treatment_rep expression_level
1 GEN_A     control_rep1       -0.5312459
2 GEN_B     control_rep1        3.4286519
3 GEN_C     control_rep1       -3.4287675
4 GEN_D     control_rep1       2.7277366

Reshape data
```{r}
expr <- gather(data, "treatment","expr", 2:21)
View(expr)
```


Create a heatmap

```{r}
# Elaboration of heatmap (white - steelblue)

ggplot(data, aes(y=ContigName)) +
  geom_tile(aes(fill = expression_level), color = "white") +
  scale_fill_gradient(low = "white", high = "steelblue") +
  ylab("Genes ") +
  xlab("Treatments") +
  theme(legend.title = element_text(size = 10),
        legend.text = element_text(size = 12),
        plot.title = element_text(size=16),
        axis.title=element_text(size=14,face="bold"),
        axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(fill = "Expression level")
```

Reshapte data
```{r}
test <- gather(data, "ContigName", "expression", 2:21)
View(test)
```


PARAMETERS:

CopperSig= specifies which matrix to get the data from (in our case, CopperSig is what we named our matrix before)
col= sets the color used for the image (my_palette was a vector previously defined in code above)
breaks= breaks up points based on colors
density.info= indicates whether to superimpose a 'histogram', a 'density plot', or 'none')
trace= determines if a solid 'trace' line should be drawn across rows and down columns (can select for just 'row's and 'column's if preferred).
dendrogram=c("row") plots a row dendrogram and reorders the rows (the original rows and columns are reordered to match the dendrogram).
symm= indicates if matrix should be treated symmetrically (only 'T', or 'True', if matrix is square)
symkey= indicates whether the color key should be made symmetric about 0
symbreaks= indicates whether the breaks in the heatmap should be made symmetric about 0
scale= indicates whether data is scaled (options are 'none', 'T', 'F')
margins= sets the margins for the heatmap. If you want your heatmap to be longer and thinner, you make the first number in the ( ) smaller

--i.e., I have it set at 7, 18 right now. I've also used 9, 14 in the past. Sometimes you just have to change those numbers around to get the
--heatmap size desired (I made things longer when I could in order to try to be able to read the gene names, may or may not work depending on how many genes you are mapping)

Colv= determines if and how the column dendrogram should be reordered. Colv=Rowv indicates that columns should be treated identically to the rows
lwid= column width
lhei= column height
cexRow= adjusts font size